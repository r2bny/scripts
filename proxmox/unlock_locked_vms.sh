#!/bin/bash
#===============================================================================
# Script:        unlock_locked_vms.sh
# Description:   Снимает статус "locked" со всех зависших виртуальных машин.
# Author:        R2BNY
# Created:       2025-05-05
# Version:       1.0.0
# Environment:   Proxmox VE, Bash
#===============================================================================
echo "Поиск заблокированных виртуальных машин."
LOCKED_VMS=$(qm list | awk '/locked/ {print $1}')

if [[ -z "$LOCKED_VMS" ]]; then
    echo "[✓] Нет виртуальных машин со статусом locked."
    exit 0
fi

for VMID in $LOCKED_VMS; do
    echo "[!] Сброс блокировки для виртуальной машины с идентификатором: $VMID"
    qm unlock "$VMID"
done

echo "Все заблокированные виртуальные машины разблокированы."
#===============================================================================
# End of script
#===============================================================================
